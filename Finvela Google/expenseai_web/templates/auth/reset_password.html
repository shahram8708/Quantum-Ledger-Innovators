{% extends 'base.html' %}
{% from 'macros/forms.html' import render_field %}
{% block content %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

  .reset-viewport {
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at center, rgba(59, 130, 246, 0.18), rgba(236, 72, 153, 0.2));
    min-height: 100vh;
    display: flex;
    align-items: center;
  }

  .reset-card {
    background: rgba(255, 255, 255, 0.98);
    border: 1px solid rgba(148, 163, 184, 0.2);
    box-shadow: 0 25px 70px -35px rgba(59, 130, 246, 0.55);
    border-radius: 2rem;
  }

  .reset-chip {
    border-radius: 9999px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .reset-instruction {
    border-left: 4px solid rgba(236, 72, 153, 0.5);
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(236, 72, 153, 0.12));
  }

  .btn-gradient-success {
    background: linear-gradient(135deg, #10b981, #ec4899);
    border: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .btn-gradient-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 40px -30px rgba(236, 72, 153, 0.65);
  }

  .reset-helper {
    backdrop-filter: blur(12px);
    background: rgba(59, 130, 246, 0.08);
    border: 1px solid rgba(59, 130, 246, 0.18);
    border-radius: 1.25rem;
  }

  @media (max-width: 575.98px) {
    .reset-card {
      border-radius: 1.5rem;
      padding: 2.25rem !important;
    }
  }
</style>

<div>
  <div class="container">
    <div class="row justify-content-center animate-fade-up">
      <div class="">
        <div class="reset-card p-4 p-md-5">
          <div class="text-center mb-4">
            <span class="badge bg-success-subtle text-success-emphasis reset-chip px-3 py-2">Secure update</span>
            <h1 class="display-6 fw-bold mt-3">Choose a new password</h1>
            <p class="text-muted mb-0">Resetting password for <strong>{{ masked_email }}</strong>. Use at least 12 characters with a mix of letters, numbers, and symbols.</p>
          </div>

          <div class="alert reset-instruction border-0 shadow-sm" role="alert">
            <div class="d-flex gap-3 align-items-start">
              <span class="fs-4">üß≠</span>
              <div>
                <h2 class="h6 mb-1 fw-semibold">Stronger password tips</h2>
                <p class="mb-0 small">Avoid reusing old passwords. Combine uppercase, lowercase, digits, and punctuation. Password managers generate safe options instantly.</p>
              </div>
            </div>
          </div>

          <form method="post" novalidate data-loading-form class="mt-4">
            {{ form.hidden_tag() }}
            {{ render_field(form.password, icon='shield-lock-fill', autocomplete='new-password', attributes={'data-bs-toggle': 'tooltip', 'data-bs-placement': 'left', 'title': 'Enter a complex password you haven\'t used before'}) }}
            {{ render_field(form.confirm_password, icon='shield-check', autocomplete='new-password') }}
            <button type="submit" class="btn btn-gradient-success w-100 btn-lg text-white d-flex align-items-center justify-content-center gap-2 mt-3" data-loading-button>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true" data-loading-spinner></span>
              <span data-loading-label>Update password</span>
            </button>
          </form>

          <div class="row g-3 mt-4">
            <div class="col-12 col-md-6">
              <div class="reset-helper p-3 h-100">
                <div class="d-flex gap-2">
                  <span class="fs-4">üîë</span>
                  <div>
                    <h3 class="h6 fw-semibold mb-1">Remember this?</h3>
                    <p class="small mb-0">Store the new password in your manager or note it down securely to avoid another reset.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="reset-helper p-3 h-100">
                <div class="d-flex gap-2">
                  <span class="fs-4">üõ°Ô∏è</span>
                  <div>
                    <h3 class="h6 fw-semibold mb-1">Enable MFA</h3>
                    <p class="small mb-0">Once you sign in, enable multi-factor authentication for an extra layer of protection.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <p class="text-center text-muted mt-4 mb-0">
            Remembered your password? <a href="{{ url_for('expenseai_auth.login') }}">Return to sign in</a>.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
